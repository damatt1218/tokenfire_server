<header class="page-header">
  <h1>
    <%= @application.name.capitalize %>
    <small class="pull-right">
      <%= link_to 'App Key', oauth_application_path(@application), :class => "btn btn-info" %>
      <%= link_to 'Edit', edit_oauth_application_path(@application), :class => "btn btn-info" %>
      <% if current_user.role? :admin %>
          <%= link_to 'View OAuth Attributes', oauth_application_path(@application), :class => "btn btn-info" %>
          <% if @application.accepted == false %>
              <%= link_to 'Accept Application', apps_accept_path(@application), :class => "btn btn-info" %>
          <% end %>
          <% if @application.disabled == true %>
              <%= link_to 'Restore', apps_restore_path(@application), :class => "btn btn-info" %>
          <% end %>
      <% end %>
      <% if @application.disabled == false %>
        <% if @application.submitted == false %>
          <%= link_to 'Submit For Review', apps_submit_path(@application), :class => "btn btn-info" %>
        <% end %>
        <%= link_to 'Delete', apps_disable_path(@application), :class => "btn btn-info", :data => {:confirm => 'Are you sure?'} %>
      <% end %>
    </small>
  </h1>
</header>

<!-- KPI -->
<section>
  <h4>Daily Statistics</h4>

  <div class="row-fluid">
    <!-- KPI #1 -->
    <div class="well span4">
      <div>
        <i class="icon-download-alt icon-4x pull-left"></i>

        <div>
          <h4 class="media-heading">Downloads</h4>

          <p class="lead"><%= number_with_delimiter(@downloads_count, :delimiter => ',') %></p>
        </div>
      </div>
    </div>
    <!-- /KPI #1 -->
    <!-- KPI #2 -->
    <div class="well span4">
      <div>
        <i class="icon-group icon-4x pull-left"></i>

        <div>
          <h4 class="media-heading">Daily Active Users</h4>

          <p class="lead"><%= number_with_delimiter(@dau, :delimiter => ',') %></p>
        </div>
      </div>
    </div>
    <!-- /KPI #2 -->
    <!-- KPI #3 -->
    <div class="well span4">
      <div>
        <i class="icon-calendar icon-4x pull-left"></i>

        <div>
          <h4 class="media-heading">Monthly Active Users</h4>

          <p class="lead"><%= number_with_delimiter(@mau, :delimiter => ',') %></p>
        </div>
      </div>
      <!-- /KPI #3 -->
    </div>
  </div>
</section>
<!-- /KPI -->

<!-- Graphs -->
<div class="row-fluid">

</div>
<!-- /Graphs -->
<!-- Session Analytics -->
<div class="row-fluid">
  <h4>Application Statistics</h4>
  <table class="table table-bordered">
    <thead>
    <tr>
      <th>Total Users</th>
      <th>Avg. Sessions per day</th>
      <th>Avg. Sessions per month</th>
      <th>Avg. Session time</th>
      <th>Total playtime</th>
      <th>Avg. Achievements</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <% if @downloads_count == 0 %>
        <td colspan=6>No Downloads Yet</td>
      <% else %>
      <td><%= @downloads_count %></td>
      <td><%= @application.getAverageSessionsPerDay %></td>
      <td><%= @application.getAverageSessionsPerMonth %></td>
      <td><%= Time.at(@application.getAverageSessionLength).gmtime.strftime('%R:%S') %></td>
      <td><%= Time.at(@application.getTotalUsageTime).gmtime.strftime('%R:%S') %></td>
      <td><%= @application.getAverageAchievements %>/<%= @application.achievements.length %></td>
      <% end %>
    </tr>
    </tbody>
  </table>
</div>
<!-- /Session Analytics -->

<!-- Session Analytics -->
<div class="row-fluid">

  <h4>Campaigns</h4>

  <p><%= link_to 'New Campaign', new_app_campaign_path(@application), :class => "btn btn-primary" %></p>

  <div>
    <table class="table table-bordered table-striped table-hover">
      <thead>
      <tr>
        <th>Name</th>
        <th>Overall Budget (USD)</th>
        <th>Overall Spent (USD)</th>
        <th>Remaining Overall Budget (USD)</th>
        <th>Daily Budget (USD)</th>
        <th>Daily Spent (USD)</th>
        <th>Remaining Daily Budget (USD)</th>
        <th>Active</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <% @application.campaigns.where(:soft_deleted => false).each do |campaign| %>
          <tr>
            <td><%= link_to campaign.name, app_campaign_path(@application, campaign) %></td>
            <td><%= campaign.overall_budget %></td>
            <td><%= campaign.overall_used_budget %></td>
            <td><%= campaign.overall_budget - campaign.overall_used_budget %></td>
            <td><%= campaign.daily_budget %></td>
            <td><%= campaign.daily_used_budget %></td>
            <td><%= campaign.daily_budget - campaign.daily_used_budget %></td>
            <td><%= campaign.active %></td>

            <td><%= link_to 'Edit', edit_app_campaign_path(@application, campaign) %></td>
          </tr>
      <% end %>
      </tbody>
    </table>


    <% if current_user.role? :admin %>
        <h5>Deleted Campaigns</h5>
        <table class="table table-bordered table-striped table-hover">
            <thead>
            <tr>
              <th>Name</th>
              <th>Overall Budget (USD)</th>
              <th>Overall Spent (USD)</th>
              <th>Remaining Overall Budget (USD)</th>
              <th>Daily Budget (USD)</th>
              <th>Daily Spent (USD)</th>
              <th>Remaining Daily Budget (USD)</th>
              <th>Active</th>
              <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <% @application.campaigns.where(:soft_deleted => true).each do |campaign| %>
                <tr>
                  <td><%= link_to campaign.name, app_campaign_path(@application, campaign) %></td>
                  <td><%= campaign.overall_budget %></td>
                  <td><%= campaign.overall_used_budget %></td>
                  <td><%= campaign.overall_budget - campaign.overall_used_budget %></td>
                  <td><%= campaign.daily_budget %></td>
                  <td><%= campaign.daily_used_budget %></td>
                  <td><%= campaign.daily_budget - campaign.daily_used_budget %></td>
                  <td><%= campaign.active %></td>

                  <td><%= link_to 'Edit', edit_app_campaign_path(@application, campaign) %></td>
                </tr>
            <% end %>
            </tbody>
        </table>

    <% end %>
  </div>
</div>

<%= link_to "Back to Overview", apps_path %>


