<div class="span16">
  <header class="page-header">
    <h1>Application: <%= @application.name %></h1>
    <h2>Campaign: <%= @campaign.name %></h2>
  </header>
</div>

<div class="span10">
  <% if !@campaign.active %>
    <p><%= link_to 'Activate Campaign', app_activate_app_campaign_path(@application, @campaign), :class => "btn btn-primary", :data => {:confirm => 'Activate this campaign?'} %></p>
  <% else %>
    <p><%= link_to 'Deactivate Campaign', app_deactivate_app_campaign_path(@application, @campaign), :class => "btn btn-primary", :data => {:confirm => 'Deactivate this campaign?'} %></p>
  <% end %>
</div>

<div class="span10">
  <table class="table table-bordered table-striped table-hover">
    <thead>
    <tr>
      <th>Description</th>
      <th>Overall Budget (USD)</th>
      <th>Overall Used Budget (USD)</th>
      <th>Daily Budget (USD)</th>
      <th>Daily Used Budget (USD)</th>
      <th>Active</th>
    </tr>
    </thead>
    <tbody>
      <tr>
        <td><%= @campaign.description %></td>
        <td><%= @campaign.overall_budget %></td>
        <td><%= @campaign.overall_used_budget %></td>
        <td><%= @campaign.daily_budget %></td>
        <td><%= @campaign.daily_used_budget %></td>
        <td><%= @campaign.active %></td>
      </tr>
    </tbody>
  </table>

  <div class="row-fluid">
    <h4>Achievements</h4>

    <p><%= link_to 'New Achievement', new_app_campaign_achievement_path(@application, @campaign), :class => "btn btn-primary" %></p>

    <div>
      <table class="table table-bordered table-striped table-hover">
        <thead>
        <tr>
          <th>Name</th>
          <th>Cost (USD)</th>
          <th>Avg. time to complete</th>
          <th>Percent of Users</th>
          <th>Times achieved</th>
          <th>Achievement UID</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <% @campaign.achievements.where(:soft_deleted => false).each do |achievement| %>
            <tr>
              <td><%= link_to achievement.name, app_campaign_achievement_path(@application, @campaign, achievement) %></td>
              <td><%= achievement.cost %></td>
              <td><%= Time.at(@application.getAverageDurationForAchievement(achievement)).gmtime.strftime('%R:%S') %></td>
              <td>
                <% if @downloads_count > 0 %>
                    <%= 100.0 * achievement.achievement_history.count / @downloads_count %>
                <% else %>
                    0
                <% end%>
                %
              </td>
              <td><%= achievement.achievement_history.count %></td>
              <td><%= achievement.uid %></td>
              <td><%= link_to 'Edit', edit_app_campaign_achievement_path(@application, @campaign, achievement) %></td>
            </tr>
        <% end %>
        </tbody>
      </table>

      <% if current_user.role? :admin %>
          <h5>Deleted Achievements</h5>
          <table class="table table-bordered table-striped table-hover">
            <thead>
            <tr>
              <th>Name</th>
              <th>Cost (USD)</th>
              <th>Avg. time to complete</th>
              <th>Percent of Users</th>
              <th>Times achieved</th>
              <th>Achievement UID</th>
              <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <% @application.achievements.where(:soft_deleted => true).each do |achievement| %>
                <tr>
                  <td><%= link_to achievement.name, app_campaign_achievement_path(@application, @campaign, achievement) %></td>
                  <td><%= achievement.cost %></td>
                  <td><%= @application.getAverageDurationForAchievement(achievement) %></td>
                  <td>
                    <% if @downloads_count > 0 %>
                        <%= 100.0 * achievement.achievement_history.count / @downloads_count %>
                    <% else %>
                        0
                    <% end%>
                    %
                  </td>
                  <td><%= achievement.achievement_history.count %></td>
                  <td><%= achievement.uid %></td>
                  <td><%= link_to 'Edit', edit_app_campaign_achievement_path(@application, @campaign, achievement) %></td>
                </tr>
            <% end %>
            </tbody>
          </table>
      <% end %>
    </div>
  </div>


  <div>
    <%= link_to 'Edit', edit_app_campaign_path(@application, @campaign), :class => "btn primary" %>
    <%= link_to 'Back to App', app_path(@application), :class => "btn" %>
  </div>
</div>

